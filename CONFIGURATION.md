# 微信登录系统配置说明

## 环境变量配置

创建 `.env` 文件在项目根目录，包含以下配置：

```bash
# 微信公众号配置
WECHAT_APP_ID=your_app_id_here
WECHAT_APP_SECRET=your_app_secret_here

# 登录配置
WECHAT_LOGIN_KEYWORD=登录
WECHAT_SESSION_TIMEOUT=3600

# Flask配置
FLASK_SECRET_KEY=your_secret_key_here
```

## 微信公众号后台配置

### 1. 服务器配置
- 登录微信公众平台 (https://mp.weixin.qq.com/)
- 进入"设置与开发" → "基本配置"
- 配置服务器地址：
  - URL: `https://yourdomain.com/wechat/message`
  - Token: 自定义（可选）
  - EncodingAESKey: 自动生成

### 2. 功能配置
- 启用"客服功能"
- 配置"自动回复"规则（可选）

## 域名配置要求

### 必须条件
- 域名必须已备案（中国大陆）
- 必须使用HTTPS协议
- 端口必须是80或443

### 推荐配置
- 使用CDN加速
- 配置SSL证书
- 设置域名解析

## 测试配置

### 1. 本地测试
```bash
# 运行测试脚本
python test_wechat_simple.py

# 启动应用
python app/main.py
```

### 2. 生产环境测试
1. 配置真实域名
2. 设置SSL证书
3. 配置微信公众号回调
4. 测试登录流程

## 常见配置问题

### 1. 配置未生效
- 检查 `.env` 文件是否在正确位置
- 确认环境变量名称正确
- 重启应用使配置生效

### 2. 域名验证失败
- 检查域名是否已备案
- 确认SSL证书有效
- 验证域名解析正确

### 3. 微信API调用失败
- 检查APP_ID和APP_SECRET
- 确认公众号已认证
- 验证服务器配置正确

## 安全配置建议

### 1. 密钥管理
- 使用强随机密钥
- 定期更换密钥
- 避免密钥泄露

### 2. 访问控制
- 限制API访问频率
- 监控异常登录
- 记录操作日志

### 3. 数据保护
- 加密敏感数据
- 定期备份数据
- 设置访问权限

## 性能优化配置

### 1. 缓存配置
- 启用access_token缓存
- 配置会话存储
- 优化数据库查询

### 2. 并发配置
- 设置连接池
- 配置工作进程
- 优化资源使用

## 监控和日志

### 1. 日志配置
- 记录API调用
- 记录用户操作
- 记录错误信息

### 2. 监控指标
- 登录成功率
- API响应时间
- 系统资源使用

## 故障排除

### 1. 检查清单
- [ ] 环境变量配置正确
- [ ] 微信公众号配置完成
- [ ] 域名解析正常
- [ ] SSL证书有效
- [ ] 服务器可访问

### 2. 调试方法
- 查看应用日志
- 检查微信API返回
- 验证网络连接
- 测试配置参数

---

*配置完成后，请运行测试脚本验证系统是否正常工作。*
