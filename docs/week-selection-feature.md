# 周次选择功能说明

## 功能概述

在内部页面的"上传周"选择组件中，用户现在可以选择任意的周次时间，上传的文件会自动重命名为选择的时间格式。

## 功能特性

### 1. 周次选择范围
- **过去周次**: 默认显示过去52周（约1年）
- **当前周次**: 自动标记为"[当前]"
- **未来周次**: 默认显示未来52周（约1年）
- **总计**: 约105个周次选项

### 2. 周次格式
- **选择值**: `YYYY-WNN` 格式（如：2025-W32）
- **显示标签**: 友好格式（如：2025年第32周 (08月04日-08月10日)）
- **文件名**: 自动生成格式（如：2025-W32-0804-0810）

### 3. 文件重命名规则
当用户选择周次并上传文件时：
1. 系统根据选择的周次自动生成文件名
2. 文件名格式：`{周次}-{开始日期}-{结束日期}.{扩展名}`
3. 示例：选择"2025-W32" → 文件保存为"2025-W32-0804-0810.jpg"

## 技术实现

### 后端API
- **端点**: `/api/week-options`
- **方法**: GET
- **返回**: JSON格式的周次选项列表

### 前端组件
- **下拉框**: 显示所有可用周次
- **刷新按钮**: 重新加载周次选项
- **表单验证**: 确保选择有效的周次格式
- **确认提示**: 显示文件保存信息

### 文件保存逻辑
```python
# 根据选择的周次生成文件名
week_options = generate_week_options()
selected_week = None

# 查找匹配的周次选项
for option in week_options:
    if option["value"] == week_str:
        selected_week = option
        break

# 使用生成的文件名格式保存文件
filename = selected_week["filename"]
save_path = SCHEDULES_DIR / f"{filename}.{ext}"
```

## 使用流程

1. **访问内部页面**: 导航到 `/insider`
2. **选择周次**: 从下拉框中选择目标周次
3. **选择文件**: 上传排班表图片文件
4. **提交上传**: 点击"提交保存"按钮
5. **确认信息**: 系统显示确认对话框
6. **自动重命名**: 文件保存为选择的周次格式

## 示例

### 选择周次
- 用户选择：2025年第32周 (08月04日-08月10日)
- 系统值：2025-W32

### 文件重命名
- 原始文件名：schedule.jpg
- 保存后文件名：2025-W32-0804-0810.jpg

## 配置选项

可以通过修改 `generate_week_options()` 函数参数来调整周次范围：

```python
# 默认配置：前后各52周
week_options = generate_week_options(num_weeks_back=52, num_weeks_forward=52)

# 自定义配置：前后各26周（约半年）
week_options = generate_week_options(num_weeks_back=26, num_weeks_forward=26)
```

## 注意事项

1. **文件覆盖**: 如果同一周次已有文件，新文件会覆盖旧文件
2. **格式验证**: 只接受有效的周次格式（YYYY-WNN）
3. **时区处理**: 基于系统当前时间计算周次
4. **文件扩展名**: 保持原始文件的扩展名

## 更新日志

- **2025-01-XX**: 实现周次选择功能
- **2025-01-XX**: 添加文件自动重命名
- **2025-01-XX**: 优化用户界面和体验
